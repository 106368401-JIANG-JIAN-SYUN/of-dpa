<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>OpenFlow Data Plane Abstraction (OF-DPA) API Guide and Reference Manual: OF-DPA Platform Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css" />
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenFlow Data Plane Abstraction (OF-DPA) API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="pages.html"><span>OF-DPA&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">OF-DPA Platform Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="OFDPA_BSP_SUPPORT"></a>
OF-DPA Platform BSP Support</h1>
<p>Because OF-DPA is a reference design, it does not provide complete Board Support Packages (BSP) for any switches. Usually all that is supported is the minimum required to forward traffic. Some switches have limited support for fiber transceivers and I2C, but this is only because this support is required to turn on the power to the transceivers. None of the supported switches have support for managing power supplies or fans. Usually, the port LEDs are not supported either. A few platforms have partial LED support.</p>
<p>There is some basic infrastructure for supporting BSP features. Examine the code in the systems/cpu/common/src and systems/platform/common.</p>
<h1><a class="anchor" id="OFDPA_PLATFORM_PORTING"></a>
Porting a New Platform</h1>
<h2><a class="anchor" id="OFDPA_PLATFORM_INTRODUCTION"></a>
Introduction</h2>
<p>The OF-DPA BSP is made up of two major components: the CPU complex and the platform definition. The CPU complex can provide support for the CPU, Flash, and drivers for all the peripherals attached to the CPU. The platform support defines the characteristics of the switch chip and provides functions to support its operation.</p>
<p>To port OF-DPA to new hardware, the OF-DPA BSP must be modified. This is most easily accomplished in these phases: </p><ul>
<li><a class="el" href="OFDPA_PLATFORM.html#OFDPA_PLATFORM_CPU_INTEGRATION">CPU Integration</a> </li>
<li><a class="el" href="OFDPA_PLATFORM.html#OFDPA_PLATFORM_SUPPORT">Platform Support</a> </li>
<li><a class="el" href="OFDPA_PLATFORM.html#OFDPA_PLATFORM_BUILD_DIRECTORY">New Build Directory</a></li>
</ul>
<p>It is often a good starting point to clone the files from a similar switch. For example, when support for the BCM956260K (Saber2) SVK was added, the files for the BCM56450K (Katana2) SVK were copied and modified.</p>
<h2><a class="anchor" id="OFDPA_PLATFORM_CPU_INTEGRATION"></a>
CPU Integration</h2>
<p>The new CPU complex should be named and a new directory created for it under the systems/cpu/ directory. One of the reference platform's CPU directories can be cloned to support the new CPU. The environment variable L7_CPU must also be updated. Alternatively, an existing CPU can be modified to support the new hardware and an unmodified version can be preserved to run on the reference platform.</p>
<dl class="section user"><dt>Linux Integration</dt><dd>This section describes each of the directories under systems/cpu/&lt;newCPU&gt;/linux.<ul>
<li>The build directory contains a file that should be named cpu.cfg. It sets up environment variables to support the build process. It will probably not be necessary to modify this file. If the CFLAGS need to be customized, it should be performed in this file.</li>
<li>The include directory contains the file platform_cpu.h. This file exports BSP values to OF-DPA. It is probably not necessary to update this file for the initial integration.</li>
<li>The src directory contains the file cpu_init.c, which contains the cpuInit() function. This function is called to perform initialization specific to this board such as a mmap for a CPLD, an open of /dev/nvram if the environment variables were stored in NVRAM, or a hardware reset. The cpuInit function is called as part of the driver initialization in driverInit() in driver_util.c.</li>
<li>The system directory contains the root file system. The directory rootfs contains the files necessary to generate the root file system. If the reference BSP is the same architecture and uses the same toolchain, it is not necessary to update any files in this directory.</li>
<li>The target directory contains any other code required (if necessary) to boot the switch such as an updated u-boot.</li>
</ul>
</dd></dl>
<p>For information on other configuration (such as kernel configuration) necessary in the CPU complex, refer to <a class="el" href="OFDPA_BUILDING.html#OFDPA_INSTALLING_KERNEL">Installing and Building the Linux Kernel</a>.</p>
<h2><a class="anchor" id="OFDPA_PLATFORM_SUPPORT"></a>
Platform Support</h2>
<p>Select a reference platform that is based on the same chip as the new platform. Create a new directory under the systems/platform directory and copy the contents from a reference platform that supports a similar switch chip. </p><ul>
<li>The platform.h file contains #defines that are used for certain platform limits. Usually this should not need to be modified. </li>
<li>The platform_init.c file implements the functions that provide any SDK customization and set up the port map. This file is required to implement the following functions:<ul>
<li>platformInit &ndash; implements any required initialization. Usually this includes detecting the switch, setting SOC properties and determining the port map.</li>
<li>platformNumPortsGet &ndash; returns the number of ports defined on this switch.</li>
<li>platformPortMappingGet &ndash; provides a port mapping array to map OF-DPA ports to BCM ports.</li>
<li>platformScriptGet &ndash; provides a list of BCM shell commands to be performed at initialization. May return a NULL pointer if no commands.</li>
<li>platformCustomLinkScanHandler &ndash; performs any necessary activity when a ports link state changes. Often does nothing.</li>
</ul>
</li>
</ul>
<p>Sometimes multiple switches can be supported by the same "platform". Usually this is when the same switches can use exactly the same Linux kernel and have the same CPU requirements. An example of this kind of platform is the gto platform.</p>
<h2><a class="anchor" id="OFDPA_PLATFORM_BUILD_DIRECTORY"></a>
New Build Directory</h2>
<p>Make the following changes in the output build folder:</p>
<ul>
<li>Add a new directory in the output folder with the platform name. The convention has been &lt;cpu&gt;-&lt;switch&gt;-&lt;os&gt; but it is not required to follow the convention. </li>
<li>Copy the Makefile from an existing output folder to this new folder. </li>
<li>Modify the variables in the new Makefile as appropriate for the new platform and for the build environment. The variables most likely to need modifying are:<ul>
<li>CROSS_COMPILE</li>
<li>L7_TARGETOS_VARIANT</li>
<li>L7_CPU</li>
<li>KERNEL_SRC</li>
<li>PLATFORM_CODE</li>
<li>kernel_version</li>
</ul>
</li>
</ul>
<p>For more information about make variables, see <a class="el" href="OFDPA_BUILDING.html#OFDPA_BUILDING_CODE">Building OF-DPA Source Code</a>. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<hr>
<p>
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design.
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>
</p>
</div>
<!--END GENERATE_TREEVIEW-->
</body>
</html>
