<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenFlow Data Plane Abstraction (OF-DPA) API Guide and Reference Manual: OF-DPA Configuration</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenFlow Data Plane Abstraction (OF-DPA) API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="../../pages.html"><span>OF-DPA&#160;Documentation</span></a></li>
      <li><a href="../../modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d6/d4b/TE_INFO.html">OFDPA 1.0 Traffic Engineering Test Case</a></li><li class="navelem"><a class="el" href="../../d2/d47/TE_USE_CASE.html">Traffic Engineering use case</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">OF-DPA Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CLIENT_APPLICATION_CONF"></a>
Client Application Configuration</h1>
<p>The client applications are used as testing tools to configure flows in OF-DPA. Here is the configuration for both scenario A and B using these applications.</p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CLIENT_APPLICATION_CONF_SCENARIO_A"></a>
Scenario A</h2>
<p><b>Add VLAN Flow Table entries</b></p>
<ul>
<li>./client_vlan -i 1 -v 0x100a -m 0x1fff </li>
<li>./client_vlan -i 2 -v 0x100a -m 0x1fff </li>
<li>./client_vlan -i 5 -v 0x100a -m 0x1fff</li>
</ul>
<p>The above configuration will add ports 1, 2 and 5 in VLAN 10.</p>
<p><b>Create two L2 Interface Groups</b></p>
<p>Create an L2 interface group on interface 3 and VLAN 11</p>
<ul>
<li>./client_group &ndash;groupid=0xb0003 </li>
<li>./client_group &ndash;groupid=0xb0003 &ndash;l2intfbktid=0 &ndash;outport=3 &ndash;popvlan=0</li>
</ul>
<p>Create an L2 interface group on interface 4 and VLAN 11</p>
<ul>
<li>./client_group &ndash;groupid=0xb0004 </li>
<li>./client_group &ndash;groupid=0xb0004 &ndash;l2intfbktid=0 &ndash;outport=4 &ndash;popvlan=0</li>
</ul>
<p><b>Create a Termination MAC Flow table entry to route the ingress traffic</b></p>
<ul>
<li>./client_termmac &ndash;intf=0 &ndash;vlan=10 &ndash;dstmac=00:01:02:03:04:05</li>
</ul>
<p><b>Create two L3 Unicast Groups with reference to the above created L2 Interface groups</b></p>
<ul>
<li>./client_group &ndash;groupid=0x20000001 </li>
<li>./client_group &ndash;groupid=0x20000001 &ndash;l3ucastbktid=0 &ndash;l3ucastdstMac=00:00:00:00:00:01 &ndash;l3ucastsrcMac=00:01:02:03:04:05 &ndash;l3ucastrefGID=0xb0003 &ndash;l3ucastvlanId=11</li>
</ul>
<p>This creates an L3 Unicast group with group Id <b>0x20000001</b>. This group defines an action which sends a tagged packet out on port 3 with VLAN 11 and the configured destination and source MAC.</p>
<ul>
<li>./client_group &ndash;groupid=0x20000002 </li>
<li>./client_group &ndash;groupid=0x20000002 &ndash;l3ucastbktid=0 &ndash;l3ucastdstMac=00:00:00:00:00:02 &ndash;l3ucastsrcMac=00:01:02:03:04:05 &ndash;l3ucastrefGID=0xb0004 &ndash;l3ucastvlanId=11</li>
</ul>
<p>This creates an L3 Unicast group with group Id <b>0x20000002</b>. This group defines an action which sends a tagged packet out on port 4 with VLAN 11 and the configured destination and source MAC.</p>
<p><b>Create an ECMP Group and add the above created Unicast Groups into it</b></p>
<ul>
<li>./client_group &ndash;groupid=0x70000001 </li>
<li>./client_group &ndash;groupid=0x70000001 &ndash;refgroupsbktid=0 &ndash;refgroupsrefGID=0x20000001 </li>
<li>./client_group &ndash;groupid=0x70000001 &ndash;refgroupsbktid=1 &ndash;refgroupsrefGID=0x20000002</li>
</ul>
<p>This creates an ECMP group with group Id <b>0x70000001</b> with two next hops in the group.</p>
<p><b>Create a Unicast Routing Flow table entry</b></p>
<ul>
<li>./client_routing &ndash;dstip4=192.168.5.0 &ndash;ether=0x800 &ndash;prefix=24 &ndash;setgroup=0x70000001</li>
</ul>
<p>This creates a Unicast Routing Flow entry that matches IPv4 packets (ether type 0x800) with destination IP subnet 192.168.5.0 and routes the packets to the ECMP next hop group <b>0x70000001</b>.</p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CLIENT_APPLICATION_CONF_SCENARIO_B"></a>
Scenario B</h2>
<p><b>All the configuration of scenario A is required.</b></p>
<p><b>On top of it create an ACL Policy Flow table entry</b></p>
<ul>
<li>./client_acl –intf=1 &ndash;dstmac=00:01:02:03:04:05 &ndash;ether=0x0800 &ndash;srcmac=00:00:00:00:00:00 –srcmacmask=00:00:00:00:00:00 &ndash;vlan=10 &ndash;dstip4=192.168.5.1 &ndash;srcip4=0 &ndash;proto=1 &ndash;dstport=0 &ndash;srcport=0 &ndash;setgroup=0x20000001</li>
</ul>
<p>This creates an ACL Policy Flow table entry that matches incoming traffic on the given parameters and routes it to the next hop implemented by the L3 Unicast group Id <b>0x20000001</b>. This routes the packets destined to IP 192.168.5.1 out of port 3.</p>
<h1><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CPQD_DPCTL_CONF"></a>
CPqD dpctl Configuration</h1>
<p>dpctl is a command line utility from CPqD that mimics a Controller and installs flows in an OpenFlow aware switch.</p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CPQD_DPCTL_CONF_SCENARIO_A"></a>
Scenario A</h2>
<p><b>Add VLAN Flow Table entries</b></p>
<ul>
<li>./dpctl tcp:Switch_IP:[port] flow-mod cmd=add,table=10 in_port=1,vlan_vid=10 goto:20 </li>
<li>./dpctl tcp:Switch_IP[:port] flow-mod cmd=add,table=10 in_port=2,vlan_vid=10 goto:20 </li>
<li>./dpctl tcp:Switch_IP[:port] flow-mod cmd=add,table=10 in_port=5,vlan_vid=10 goto:20</li>
</ul>
<p>The above configuration will add ports 1, 2 and 5 in VLAN 10.</p>
<p>Note: dpctl does not support VLAN mask. VLAN mask should be passed as 0x1fff by the Ryu Controller if configuring VLAN Id.</p>
<p><b>Create two L2 Interface Groups</b></p>
<p>Create an L2 interface group on interface 3 and VLAN 11</p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] group-mod cmd=add,type=ind,group=720899 weight=0,port=any, group=any output=3</li>
</ul>
<p>Create an L2 interface group on interface 4 and VLAN 11</p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] group-mod cmd=add,type=ind,group=720900 weight=0,port=any, group=any output=4</li>
</ul>
<p>Create a Termination MAC Flow table entry to route the ingress traffic</p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] flow-mod cmd=add,table=20,eth_type=0x800,vlan_vid=10,eth_dst=00:01:02:03:04:05/ff:ff:ff:ff:ff:ff goto:30</li>
</ul>
<p><b>Create two L3 Unicast Groups with reference to the above created L2 Interface groups</b></p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] group-mod cmd=add,type=ind,group=536870913 weight=0,port=any,group=any set_field=vlan_vid:11,set_field=eth_dst:00:00:00:00:00:01/ff:ff:ff:ff:ff:ff,set_field=eth_src:00:01:02:03:04:05/ff:ff:ff:ff:ff:ff,group=720899</li>
</ul>
<p>This creates an L3 Unicast group with group Id <b>0x20000001</b>. This group defines an action which sends a tagged packet out on port 3 with VLAN 11 and the configured destination and source MAC.</p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] group-mod cmd=add,type=ind,group=536870914 weight=0,port=any,group=any set_field=vlan_vid:11,set_field=eth_dst:00:00:00:00:00:02/ff:ff:ff:ff:ff:ff,set_field=eth_src:00:01:02:03:04:05/ff:ff:ff:ff:ff:ff,group=720900</li>
</ul>
<p>This creates an L3 Unicast group with group Id <b>0x20000002</b>. This group defines an action which sends a tagged packet out on port 4 with VLAN 11 and the configured destination and source MAC.</p>
<p><b>Create an ECMP Group and add the above created Unicast Groups into it</b></p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] group-mod cmd=add,type=ind,group=1879048193 weight=0,port=any,group=any group=536870913 weight=0,port=any,group=any group=536870914</li>
</ul>
<p>This creates an ECMP group with group Id <b>0x70000001</b> with two next hops in the group.</p>
<p><b>Create a Unicast Routing Flow table entry</b></p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] flow-mod cmd=add,table=30 eth_type=0x800,ip_dst=192.168.5.0/24 write:group=1879048193 goto:60</li>
</ul>
<p>This creates a Unicast Routing Flow entry that matches IPv4 packets (ether type 0x800) with destination IP subnet 192.168.5.0 and routes the packets to the ECMP next hop group <b>0x70000001</b>.</p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_CPQD_DPCTL_CONF_SCENARIO_B"></a>
Scenario B</h2>
<p><b>All the configuration of scenario A is required.</b></p>
<p><b>On top of it create a ACL Policy Flow table entry</b></p>
<ul>
<li>./dpctl tcp: Switch_IP[:port] flow-mod cmd=add,table=60 in_port=1,eth_type=0x800,vlan_vid=10 ,eth_dst=00:01:02:03:04:05/ff:ff:ff:ff:ff:ff, ip_dst=192.168.5.1/32 write:group=536870913</li>
</ul>
<p>This creates an ACL Policy Flow table entry that matches incoming traffic on the given parameters and routes it to the next hop implemented by the L3 Unicast group Id <b>0x20000001</b>. This routes the packets destined to IP 192.168.5.1 out of port 3.</p>
<h1><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_RYU_CONF"></a>
Ryu Configuration</h1>
<ul>
<li>Ryu controller (RC) intended to configure OF-DPA switch by Open Flow 1.3 protocol. </li>
<li>RC working in the passive mode and listen to TCP port 6633. </li>
<li>To make changes in flow and group tables RC execute configuration script. </li>
<li>Configuration script <code> ofdpa-te.py </code> get parameters from JSON files - for each flow/group in separate file. </li>
<li>Scenario file contain list of parameter files which will be sequentially read and set.</li>
</ul>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_RYU_CONF_SCENARIO_A"></a>
Scenario A</h2>
<p><code>cd &lt;ofdpa-te.py directory&gt;</code> <br/>
 Open file <code>conf/ofdpa-te.json</code> <br/>
 Ensure that it contains: </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="stringliteral">&quot;config_directory&quot;</span>:<span class="stringliteral">&quot;conf&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;#working_directory&quot;</span>:<span class="stringliteral">&quot;scenarioA.json&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;#working_directory&quot;</span>:<span class="stringliteral">&quot;scenarioB.json&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;#working_directory&quot;</span>:<span class="stringliteral">&quot;AddACL.json&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;#working_directory&quot;</span>:<span class="stringliteral">&quot;DelACL.json&quot;</span></div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> Remove leading hash symbol from string which contains <code>scenarioA.json</code>. <br/>
 Save changes and close file. <br/>
 Open file <code>conf/scenarioA.json</code> <br/>
 Ensure that it contains: </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        [</div>
<div class="line">        <span class="stringliteral">&quot;te_add_vlan_1.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_vlan_2.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_vlan_5.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_group_l2_0xb003.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_group_l2_0xb003.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_termination_mac.json&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;te_add_group_l3_0x20000001_.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_group_l3_0x20000001.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_ecmp.json&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;te_add_ucast_routing.json&quot;</span></div>
<div class="line">        ]</div>
<div class="line">}</div>
</div><!-- fragment --><p> Examples of JSON files are located in Appendix A <br/>
 Close file. <br/>
 Run OF-DPA agent: <br/>
 <code>ofagentapp --controller=&lt;IP&gt;:6633 [-a 0|1|2|3] &amp; </code> <br/>
 ( -a is a loglevel) <br/>
 Run RC <br/>
 <code>ryu-manager ofdpa-te.py [&ndash;verbose]</code> <br/>
 To stop RC press Ctrl-C</p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_RYU_CONF_SCENARIO_B"></a>
Scenario B</h2>
<p>The same as ScenarioA, but in <code>conf/ofdpa-te.json</code> should uncomment line which contains <code>scenarioB.json</code> <br/>
 Content of <code>scenarioB.json</code> the same as <code>scenarioA.json</code> except additional line at the end: <br/>
 <code>te_add_acl.json</code></p>
<h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_RYU_CONF_ADD_ACL"></a>
Add ACL</h2>
<p>Performed only one ACL rule adding. <br/>
 This allows to perform scenario B without clean ScenarioA configuration. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&quot;te_add_acl.json&quot;</span></div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="TE_USE_CASE_OFDPA_CONFIGURATION_RYU_CONF_DEL_ACL"></a>
Del ACL</h2>
<p>Performed only one ACL rule adding. <br/>
 This allows to return from scenario B configuration. ScenarioA configuration. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    [</div>
<div class="line">        <span class="stringliteral">&quot;te_del_acl.json&quot;</span></div>
<div class="line">    ]</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Feb 28 2014 15:41:00 for OpenFlow Data Plane Abstraction (OF-DPA) API Guide and Reference Manual by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
